$(function(){var b="";function d(e){e.trigger("reset");e.find(".is-invalid").removeClass("is-invalid");e.siblings("#form-text-error").empty()}function a(h){var f='<div class="card bg-light news-card block-comment" data-comment="'+h.id+'">';f+='<div class="card-body">';f+='<h6 class="card-subtitle mb-2 text-muted">'+h.author+"</h6>";f+="<small><i>"+h.date+"</i></small>";f+='<p class="card-text">'+h.text+"</p>";f+="</div></div>";if(h.parent>0){var g=$("#news-comment-block").children('[data-comment="'+h.parent+'"]');var i=$(f).insertAfter(g);i.addClass("block-comment-child")}else{var e='<button type="button" class="btn btn-secondary float-right" data-toggle="modal" data-target="#add-comment" data-parent="'+h.id+'" data-depth="1">Ответить</button>';var i=$(f).prependTo($("#news-comment-block"));i.find(".card-body").prepend(e)}$("#no-comments").addClass("d-none")}function c(f,h){var g=[];if(typeof h=="string"){g.push(h)}else{var e;$.each(h,function(i,j){e=f.find('[name="'+j+'"]');if(e.length){e.addClass("is-invalid")}else{g.push(j)}})}if(g.length){f.siblings("#form-text-error").html(g.join("<br />"))}console.log(h)}$("#add-comment").on("show.bs.modal",function(h){var g=$(this).find("form");var f=$(h.relatedTarget);g.find('input[name="parent"]').val(f.data("parent"));g.find('input[name="depth"]').val(f.data("depth"));if(b.length){g.find('input[name="author"]').val(b)}});$("#add-comment").on("hide.bs.modal",function(g){var f=$(this).find("form");d(f)});$("#add-comment-btn").click(function(){var e=$(this).closest(".modal-content");var g=e.find("button.close");var f=e.find("form");$.post("/ajax",f.serialize(),function(h){if(h.status=="ok"){a(h.data);b=h.data.author;g.click()}else{c(f,h.errors)}},"json")})});