$(function(){function c(d){d.trigger("reset");d.find(".is-invalid").removeClass("is-invalid");d.siblings("#form-text-error").empty()}function a(g){var e='<div class="card bg-light news-card block-comment" data-comment="'+g.id+'">';e+='<div class="card-body">';e+='<h6 class="card-subtitle mb-2 text-muted">'+g.author+"</h6>";e+="<small><i>"+g.date+"</i></small>";e+='<p class="card-text">'+g.text+"</p>";e+="</div></div>";if(g.parent>0){var f=$("#news-comment-block").children('[data-comment="'+g.parent+'"]');var h=$(e).insertAfter(f);h.addClass("block-comment-child")}else{var d='<button type="button" class="btn btn-secondary float-right" data-toggle="modal" data-target="#add-comment" data-parent="'+g.id+'" data-depth="1">Ответить</button>';var h=$(e).prependTo($("#news-comment-block"));h.find(".card-body").prepend(d)}$("#no-comments").addClass("d-none")}function b(e,g){var f=[];if(typeof g=="string"){f.push(g)}else{var d;$.each(g,function(h,i){d=e.find('[name="'+i+'"]');if(d.length){d.addClass("is-invalid")}else{f.push(i)}})}if(f.length){e.siblings("#form-text-error").html(f.join("<br />"))}console.log(g)}$("#add-comment").on("show.bs.modal",function(g){var f=$(this).find("form");var d=$(g.relatedTarget);f.find('input[name="parent"]').val(d.data("parent"));f.find('input[name="depth"]').val(d.data("depth"))});$("#add-comment").on("hide.bs.modal",function(f){var d=$(this).find("form");c(d)});$("#add-comment-btn").click(function(){var d=$(this).closest(".modal-content");var f=d.find("button.close");var e=d.find("form");$.post("/ajax",e.serialize(),function(g){if(g.status=="ok"){a(g.data);f.click()}else{b(e,g.errors)}},"json")})});